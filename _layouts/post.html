<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ site.title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="{{ '/assets/img/favicon.png' | relative_url }}" type="image/png" />
    <link rel="stylesheet" href="/assets/css/style_blog.css">
    <script src="https://beamanalytics.b-cdn.net/beam.min.js" data-token="65f5dcd8-b94c-4d82-aa34-6bc36f99c13f" async>
    </script>
    <style>
    .text-purple-700 {
      color: #5238a4ff !important;
    }

    .bg-purple-700 {
      background-color: #5238a4ff !important;
    }

    .border-purple-700 {
      border-color: #5238a4ff !important;
    }
        /* Telary post image lightbox (scoped, minimal) */
        .tlry-post img {
            cursor: zoom-in;
            transition: transform 0.15s ease-in-out;
        }
        .tlry-lightbox {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.75);
            z-index: 9999;
            padding: 2rem;
        }
        .tlry-lightbox__img {
            max-width: 92vw;
            max-height: 92vh;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border-radius: 8px;
        }
        .tlry-lightbox__caption {
            margin-top: 0.75rem;
            color: #f3f4f6;
            font-size: 0.9rem;
            text-align: center;
            max-width: 92vw;
        }
        .tlry-no-scroll { overflow: hidden; }
    </style>
</head>

<body>
    {% include navbar.html %}
    <header class="bg-purple-700 text-white py-6 text-center">
        <h1 class="text-4xl font-bold">{{page.title}}</h1>
    </header>
    <main class="main-content-wrapper">
        <div class="content-with-toc">
            <!-- Article Section -->
            <article class="content-container tlry-post">
                <p class="article-date">{{ page.date | date: "%B %d, %Y" }}</p>
                <div class="">
                    {{ content }}
                </div>
            </article>

            <!-- Table of Contents Section - Right Side -->
            {% unless page.hide_toc %}
            <aside class="toc-wrapper">
                <nav id="toc" class="toc-sticky">
                    <h2 class="toc-title">Contents</h2>
                    <div id="toc-content"></div>
                </nav>
            </aside>
            {% endunless %}
        </div>
    </main>


    <!-- Lightbox markup (hidden by default) -->
    <div id="tlryLightbox" class="tlry-lightbox" aria-modal="true" role="dialog" aria-hidden="true">
        <div class="tlry-lightbox__inner" role="document">
            <img id="tlryLightboxImg" class="tlry-lightbox__img" alt="" />
            <div id="tlryLightboxCaption" class="tlry-lightbox__caption"></div>
        </div>
    </div>

    <!-- Include tocbot script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            tocbot.init({
                // Where to render the table of contents.
                tocSelector: '#toc-content',
                // Where to grab the headings to build the table of contents.
                contentSelector: 'article',
                // Which headings to grab inside of the contentSelector element.
                headingSelector: 'h1, h2, h3',
                // For smooth scrolling
                scrollSmooth: true,
            });

            // Telary: simple, accessible lightbox for post images (within the article only)
            const post = document.querySelector('article.content-container');
            const lb = document.getElementById('tlryLightbox');
            const lbImg = document.getElementById('tlryLightboxImg');
            const lbCaption = document.getElementById('tlryLightboxCaption');

            if (post && lb && lbImg) {
                const imgs = post.querySelectorAll('img');
                imgs.forEach((img) => {
                    // Skip images explicitly marked as non-zoomable
                    if (img.dataset && img.dataset.nozoom === 'true') return;

                    img.addEventListener('click', (e) => {
                        // Avoid navigating if image is wrapped in a link
                        if (e && typeof e.preventDefault === 'function') e.preventDefault();
                        const src = img.getAttribute('data-fullsrc') || img.currentSrc || img.src;
                        const alt = img.getAttribute('alt') || '';
                        const title = img.getAttribute('title') || '';
                        lbImg.src = src;
                        lbImg.alt = alt;
                        lbCaption.textContent = title || alt;
                        lb.style.display = 'flex';
                        lb.setAttribute('aria-hidden', 'false');
                        document.body.classList.add('tlry-no-scroll');
                    });
                });

                const closeLightbox = () => {
                    lb.style.display = 'none';
                    lb.setAttribute('aria-hidden', 'true');
                    lbImg.src = '';
                    document.body.classList.remove('tlry-no-scroll');
                };

                // Close on click outside image
                lb.addEventListener('click', (e) => {
                    if (e.target === lb || e.target === lbCaption) {
                        closeLightbox();
                    }
                });

                // Close on Escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && lb.style.display === 'flex') {
                        closeLightbox();
                    }
                });
            }
        });
    </script>
    {% include footer.html %}
</body>

</html>